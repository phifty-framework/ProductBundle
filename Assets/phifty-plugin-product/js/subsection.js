// Generated by CoffeeScript 1.6.3
(function() {
  var ProductSubsectionItemView, subsectionItemTemplate, _ref,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  subsectionItemTemplate = CoffeeKup.compile(function() {
    return div({
      "class": "row clearfix"
    }, function() {
      input({
        "class": "record-id",
        name: "subsections[" + this.id + "][id]",
        type: "hidden",
        value: this.id
      });
      if (this.cover_image) {
        div({
          "class": "col-md-3"
        }, function() {
          return div({
            "class": "image-cover"
          }, function() {
            return img({
              src: "/" + this.cover_image
            });
          });
        });
      }
      div({
        "class": "col-md-6"
      }, function() {
        h3(function() {
          return this.title;
        });
        return div(function() {
          return this.content;
        });
      });
      return div({
        "class": "controls"
      }, function() {
        button({
          "data-id": this.id,
          "class": "edit-btn"
        }, function() {
          return "編輯";
        });
        button({
          "data-id": this.id,
          "class": "delete-btn"
        }, function() {
          return "刪除";
        });
        return div({
          "class": "handle",
          style: "border: 1px solid #aaa; background: #d5d5d5; display: inline-block; padding: 1px 5px; "
        }, function() {
          return span({
            "class": "icon icon-sort"
          });
        });
      });
    });
  });

  ProductSubsectionItemView = (function(_super) {
    __extends(ProductSubsectionItemView, _super);

    function ProductSubsectionItemView() {
      _ref = ProductSubsectionItemView.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    ProductSubsectionItemView.prototype.render = function() {
      var $el, config, self;
      self = this;
      config = this.config;
      $el = $(subsectionItemTemplate(this.data));
      $el.find('.edit-btn').click(function(e) {
        var dialog, id;
        id = $(this).data('id');
        dialog = new CRUDDialog('/bs/product_subsection/crud/dialog', {
          id: id
        }, {
          dialogOptions: {
            width: 650,
            height: 500
          },
          onSuccess: function(resp) {
            var $parent, itemViewClass, newItem;
            $parent = $el.parent();
            $el.remove();
            itemViewClass = ProductSubsection.ItemView;
            newItem = new itemViewClass(config, resp.data);
            return newItem.appendTo($parent);
          }
        });
        return false;
      });
      $el.find('.delete-btn').click(function(e) {
        runAction(config.deleteAction, {
          id: self.data[config.primaryKey]
        }, {
          confirm: '確認刪除? ',
          remove: $el
        });
        return false;
      });
      return $el;
    };

    return ProductSubsectionItemView;

  })(CRUDList.BaseItemView);

  window.ProductSubsection = {};

  ProductSubsection.append = function(data) {};

  ProductSubsection.ItemView = ProductSubsectionItemView;

}).call(this);
