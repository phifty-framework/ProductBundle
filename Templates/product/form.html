{#
vim:filetype=htmldjango:
#}
{% set bundle = Kernel.bundle('ProductBundle') %}
<div class="product-editor">
        {{ CRUD.Action.renderSignatureWidget|raw}}
        {% if CRUD.Record.id %}
            {{ forms.hidden('id', CRUD.Record.id) }}
        {% endif %}

        <div class="row">

            <div class="col-md-6">
                <div class="col-field">
                {{ CRUD.Action.renderField('name')|raw }}
                </div>

                {% if bundle.config('with_sn') %}
                <div class="col-field">
                {{CRUD.Action.renderField('sn')|raw}}
                </div>
                {% endif %}

                <div class="clearfix"> </div>

                {% if bundle.config('with_subtitle') %}
                <div class="col-field">
                {{ CRUD.Action.renderField('subtitle') |raw}}
                </div>
                {% endif %}

                {% if Kernel.bundle('I18N') and bundle.config('with_lang') %}
                <div class="col-field">
                {{CRUD.Action.renderField('lang')|raw}}
                </div>
                {% endif %}

                {% if Kernel.bundle('StatusPlugin') %}
                <div class="col-field">
                {{CRUD.Action.renderField('status')|raw}}
                </div>
                {% endif %}

                <div class="clearfix"> </div>

                {% if bundle.config('with_category') and not bundle.config('with_multicategory') %}
                {{CRUD.Action.renderField('category_id')|raw}}
                {% endif %}

                {% if bundle.config('with_desc') %}
                {{CRUD.Action.renderField('description',{ class: 'mceEditor', rows: 3, cols: 80 })|raw}}
                {% endif %}
            </div>

            {% if bundle.config('with_category') and bundle.config('with_multicategory') %}
            <div class="col-md-3 col-md-offset-2">
                {% for langcode, categories in categoriesByLang %}
                <div class="widget lang lang-{{langcode}} hide">
                    <div class="widget-hd">{% trans langcode %}{% trans 'Category' %}</div>
                    <div class="widget-bd" style="max-height: 400px; overflow: auto; ">
                        {% set subview = CRUD.Action.asView('ActionKit\\View\\StackView',{ "no_form": 1 }) %}
                        {#
                        {{ subview.renderManyToManyEditor(CRUD.Record,'categories', categories) |raw}}
                        #}
                        {{ subview.buildManyToManyRelationalActionViewForExistingRecords(CRUD.Record, 'categories', null, null, categories)|raw}}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>


        {{CRUD.Action.renderField('content',{ class: 'mceEditor', rows: 7, cols: 80 })|raw}}
        <div class="clear"> </div>

        {% if bundle.config('with_options_content') %}
        {{CRUD.Action.renderField('options_content',{ class: 'mceEditor', rows: 7, cols: 80 })|raw}}
        <div class="clear"> </div>
        {% endif %}

        {% if bundle.config('with_cover_image') %}
            {% include '@ProductBundle/product/cover_image.html' %}
        {% endif %}

        {% if bundle.config('with_spec_image') %}
            {% include '@ProductBundle/product/spec_image.html' %}
        {% endif %}

        {% if bundle.config('with_images') %}
            {% include '@ProductBundle/product/image.html' %}
        {% endif %}

        {% if bundle.config('with_types') %}
            {% include '@ProductBundle/product/type.html' %}
        {% endif %}

        {% if bundle.config('with_resources') %}
            {% include '@ProductBundle/product/resource.html' %}
        {% endif %}

        {% if bundle.config('with_files') %}
            {% include '@ProductBundle/product/file.html' %}
        {% endif %}

        {% if bundle.config('with_related_products') %}
            {% include '@ProductBundle/product/related.html' %}
        {% endif %}

        <div class="clear"> </div>
        <div class="divider"> </div>

        <div class="collapsible collapse-section" {# data-collapse="persist" #}>
            {% if bundle.config('with_features') %}
                {% include '@ProductBundle/product/feature.html' %}
            {% endif %}

            {% if bundle.config('with_spec') %}
            <h3>產品規格</h3>
            <div>
                {{CRUD.Action.renderField('spec',{ class: 'mceEditor', rows: 4, cols: 80 })|raw}}
            </div>
            {% endif %}

            {% if bundle.config('with_properties') %}
            <h3>規格表</h3>
            <div>
                {% include '@ProductBundle/product/property.html' %}
            </div>
            {% endif %}

            {% if Kernel.bundle('SEOPlugin') 
                and bundle.config('with_seo') 
                and CRUD.Object.getModel().hasColumn('seo_keywords') 
            %}
                {% include '@SEOPlugin/fields_collapsible.html' %}
            {% endif %}


            {# 外部連結 #}
            {% if bundle.config('with_external_link') %}
                <h3>外部連結</h3>
                <div>
                    {{CRUD.Action.renderField('external_link')|raw}}
                </div>
            {% endif %}

            {% if bundle.config('with_cover_option') %}
            <h3>其他選項</h3>
            <div>
                {{CRUD.Action.renderField('is_cover')|raw}}

                {# private products are accessed by token #}
                {% if bundle.config('with_private') %}
                    {% include '@ProductBundle/product/private_token.html' %}
                {% endif %}
            </div>
            {% endif %}

            <h3>詳細資料</h3>
            <div>
                {% include '@CRUD/metadata.html' %}
                <div class="clear"> </div>
            </div>
        </div>
    <div class="clear"> </div>
</div>
<script>
$(function() {
    Product.initEdit();
});
</script>
