// Generated by CoffeeScript 1.7.1
(function() {
  var linkItemTemplate;

  linkItemTemplate = CoffeeKup.compile(function() {
    return tr(function() {
      td(function() {
        input({
          "class": "record-id",
          name: "links[" + this.id + "][id]",
          type: "hidden",
          value: this.id
        });
        return input({
          name: "links[" + this.id + "][label]",
          type: "text",
          value: this.label
        });
      });
      td(function() {
        return input({
          name: "links[" + this.id + "][url]",
          type: "text",
          size: 60,
          value: this.url
        });
      });
      td(function() {
        return button({
          "data-id": this.id,
          "class": "delete-button"
        }, function() {
          return "刪除";
        });
      });
      return td(function() {
        return div({
          "class": "handle",
          style: " border: 1px solid #aaa; background: #d5d5d5; display: block; padding: 1px 5px; "
        }, function() {
          return span({
            "class": "icon fa-sort"
          });
        });
      });
    });
  });

  window.ProductLink = {};

  ProductLink.render = function(data) {
    return $(linkItemTemplate(data));
  };

  ProductLink.append = function($container, data) {
    var $table, $tr;
    $table = $container.find('table');
    $tr = $(linkItemTemplate(data));
    $tr.find('.delete-button').click(function(e) {
      var $selfRow, id;
      if (confirm('確定刪除?')) {
        id = $(this).data('id');
        $selfRow = $(this).parents('tr').get(0);
        runAction('ProductBundle::Action::DeleteProductLink', {
          id: id
        }, function(resp) {
          return $selfRow.remove();
        });
      }
      return false;
    });
    return $table.find('tbody').append($tr);
  };

  ProductLink.initEditor = function($container) {
    var $table;
    $table = $container.find('table');
    return $container.find('.add-button').click(function(e) {
      var newLabel, newUrl;
      newLabel = $container.find('.new-link-label').val();
      newUrl = $container.find('.new-link-url').val();
      $container.find('.new-link-label').val("");
      $container.find('.new-link-url').val("");
      runAction('ProductBundle::Action::CreateProductLink', {
        label: newLabel,
        url: newUrl
      }, function(resp) {
        return ProductLink.append($container, resp.data);
      });
      return false;
    });
  };

}).call(this);
